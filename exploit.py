#!/usr/bin/env python3

from pwn import *

HOST = "localhost"
PORT = 9010

def legendre(a,p):
    leg = pow(a,(p-1)//2, p)
    if leg == p-1:
        return -1
    else:
        return leg

s = remote(HOST,PORT)

# Set m0,m1
print(s.recvuntil(b"0:").decode())
s.sendline(b"1") # ascii 49
print(s.recvuntil(b"1:").decode())
s.sendline(b"3") # ascii 51

# Get p value
print(s.recvuntil(b": ").decode())
p = s.recvuntil(b"\n").strip()
p = int(p)
print(f"p = {p}")

for i in range(20):
    ct = s.recvuntil(b"\n").strip()
    ct = ct.decode()
    print(ct)
    ct = ct.split(", ")[1][:-1]
    ct = int(ct)
    print(ct)
    leg = legendre(ct,p)
    print(f"Lengdre of ct: {leg}")
    print(s.recvuntil(b"\n").decode())
    if leg == 1:
        print()
        s.sendline(b"0")
    else:
        s.sendline(b"1")
    print(s.recvuntil(b"\n").strip().decode())


s.interactive()

